(()=>{var t={};t.id=967,t.ids=[967],t.modules={3295:t=>{"use strict";t.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:t=>{"use strict";t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},23760:(t,e,a)=>{"use strict";a.r(e),a.d(e,{patchFetch:()=>$,routeModule:()=>p,serverHooks:()=>g,workAsyncStorage:()=>c,workUnitAsyncStorage:()=>m});var r={};a.r(r),a.d(r,{GET:()=>d});var o=a(96559),s=a(48088),n=a(37719),l=a(32190),i=a(97090),u=a(44810);async function d(){try{await (0,i.A)();let t=new Date("2024-01-01"),e=new Date("2024-12-31"),a=await u.A.aggregate([{$match:{date:{$gte:t,$lte:e}}},{$group:{_id:null,totalSales:{$sum:"$sales_amount"},totalProfit:{$sum:"$profit"},totalMalfunctions:{$sum:"$malfunctionCount"}}}]),r=new Date("2023-01-01"),o=new Date("2023-12-31"),s=await u.A.aggregate([{$match:{date:{$gte:r,$lte:o}}},{$group:{_id:null,totalSales:{$sum:"$sales_amount"},totalProfit:{$sum:"$profit"},totalMalfunctions:{$sum:"$malfunctionCount"}}}]),n=await u.A.aggregate([{$match:{date:{$gte:t,$lte:e}}},{$group:{_id:"$date",value:{$sum:"$sales_amount"}}},{$sort:{_id:1}}]),d=await u.A.aggregate([{$match:{date:{$gte:t,$lte:e}}},{$group:{_id:"$date",value:{$sum:"$profit"}}},{$sort:{_id:1}}]),p=await u.A.aggregate([{$match:{date:{$gte:t,$lte:e}}},{$group:{_id:"$date",value:{$sum:"$malfunctionCount"}}},{$sort:{_id:1}}]),c=a[0]||{totalSales:0,totalProfit:0,totalMalfunctions:0},m=s[0]||{totalSales:0,totalProfit:0,totalMalfunctions:0},g=(t,e)=>0===e&&0===t?0:0===e?100:Number(((t-e)/e*100).toFixed(2)),$=g(c.totalSales,m.totalSales),f=g(c.totalProfit,m.totalProfit),v=g(c.totalMalfunctions,m.totalMalfunctions);return l.NextResponse.json({totalSales:c.totalSales,totalProfit:c.totalProfit,malfunctions:c.totalMalfunctions,salesGrowth:$,profitGrowth:f,malfunctionsChange:v,salesHistory:n.map(t=>({date:t._id,value:t.value})),profitHistory:d.map(t=>({date:t._id,value:t.value})),malfunctionsHistory:p.map(t=>({date:t._id,value:t.value}))})}catch(t){return console.error("Stats API Error:",t),l.NextResponse.json({error:"İstatistikler alınırken bir hata oluştu"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/stats/route",pathname:"/api/stats",filename:"route",bundlePath:"app/api/stats/route"},resolvedPagePath:"/Users/sevvalmertoglu/Desktop/chart-dashboard/app/api/stats/route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:c,workUnitAsyncStorage:m,serverHooks:g}=p;function $(){return(0,n.patchFetch)({workAsyncStorage:c,workUnitAsyncStorage:m})}},29294:t=>{"use strict";t.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44810:(t,e,a)=>{"use strict";a.d(e,{A:()=>n});var r=a(56037),o=a.n(r);let s=new(o()).Schema({date:{type:Date,required:!0,get:t=>t.toISOString().split("T")[0]},sales_amount:{type:Number,required:!0},profit:{type:Number,required:!0},fuelType:{type:String,enum:["Diesel","Ad Blue","Super E5","Super E10"],required:!0},tankId:{type:String,required:!0},malfunctionCount:{type:Number,default:0},fill_rate:{type:Number,required:!0,min:0,max:100}},{timestamps:!0,toJSON:{getters:!0}});s.index({date:1});let n=o().models.Sale||o().model("Sale",s)},44870:t=>{"use strict";t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},56037:t=>{"use strict";t.exports=require("mongoose")},63033:t=>{"use strict";t.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},96487:()=>{},97090:(t,e,a)=>{"use strict";a.d(e,{A:()=>l});var r=a(56037),o=a.n(r);let s="mongodb+srv://sevvalmertoglu131:Rvs1KjO1IbX9WVGL@cluster0.7hsg4vx.mongodb.net/dashboard?retryWrites=true&w=majority&appName=Cluster0";if(!s)throw Error("MONGODB_URI is not defined in environment variables");let n=global.mongoose??{conn:null,promise:null},l=async function(){if(n.conn)return console.log("MongoDB bağlantısı zaten mevcut"),n.conn;n.promise||(console.log("MongoDB bağlantısı başlatılıyor..."),n.promise=o().connect(s,{bufferCommands:!0,maxPoolSize:10,serverSelectionTimeoutMS:5e3,socketTimeoutMS:45e3}).then(t=>(console.log("MongoDB bağlantısı başarılı!"),t.connection)).catch(t=>{throw console.error("MongoDB bağlantı hatası:",t),t}));try{return n.conn=await n.promise,global.mongoose=n,n.conn}catch(t){throw n.promise=null,t}}}};var e=require("../../../webpack-runtime.js");e.C(t);var a=t=>e(e.s=t),r=e.X(0,[447,580],()=>a(23760));module.exports=r})();