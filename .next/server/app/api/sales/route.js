(()=>{var e={};e.id=678,e.ids=[678],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44810:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var a=r(56037),o=r.n(a);let s=new(o()).Schema({date:{type:Date,required:!0,get:e=>e.toISOString().split("T")[0]},sales_amount:{type:Number,required:!0},profit:{type:Number,required:!0},fuelType:{type:String,enum:["Diesel","Ad Blue","Super E5","Super E10"],required:!0},tankId:{type:String,required:!0},malfunctionCount:{type:Number,default:0},fill_rate:{type:Number,required:!0,min:0,max:100}},{timestamps:!0,toJSON:{getters:!0}});s.index({date:1});let n=o().models.Sale||o().model("Sale",s)},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},56037:e=>{"use strict";e.exports=require("mongoose")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},68174:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>$,routeModule:()=>p,serverHooks:()=>g,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>c});var a={};r.r(a),r.d(a,{GET:()=>d});var o=r(96559),s=r(48088),n=r(37719),u=r(32190),l=r(97090),i=r(44810);async function d(e){try{let t;let r=new AbortController,a=setTimeout(()=>r.abort(),1e4);await (0,l.A)();let{searchParams:o}=new URL(e.url),s=o.get("timeRange")||"weekly",n=o.get("fuelType")||"all",d=new Date("2023-01-01"),p=new Date("2024-12-31");switch(s){case"daily":t={$dateToString:{format:"%Y-%m-%d",date:"$date"}};break;case"weekly":t={$dayOfWeek:{date:"$date"}};break;case"monthly":t={$dateToString:{format:"%Y-%m",date:"$date"}};break;default:t={$dateToString:{format:"%Y-W%V",date:"$date"}}}let m=[{$match:{date:{$gte:d,$lte:p},..."all"!==n&&{fuelType:n}}},{$group:{_id:t,Diesel:{$sum:{$cond:[{$eq:["$fuelType","Diesel"]},"$sales_amount",0]}},"Ad Blue":{$sum:{$cond:[{$eq:["$fuelType","Ad Blue"]},"$sales_amount",0]}},"Super E5":{$sum:{$cond:[{$eq:["$fuelType","Super E5"]},"$sales_amount",0]}},"Super E10":{$sum:{$cond:[{$eq:["$fuelType","Super E10"]},"$sales_amount",0]}}}},{$sort:{_id:1}}],c=await i.A.aggregate(m).exec();if(clearTimeout(a),"weekly"===s){let e=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],t=c.map(t=>({...t,_id:e[t._id-1]||t._id}));return u.NextResponse.json(t)}return u.NextResponse.json(c)}catch(e){if(console.error("Sales API Error:",e),"AbortError"===e.name)return u.NextResponse.json({error:"İstek zaman aşımına uğradı"},{status:504});return u.NextResponse.json({error:"Satış verileri alınırken bir hata oluştu"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/sales/route",pathname:"/api/sales",filename:"route",bundlePath:"app/api/sales/route"},resolvedPagePath:"/Users/sevvalmertoglu/Desktop/chart-dashboard/app/api/sales/route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:m,workUnitAsyncStorage:c,serverHooks:g}=p;function $(){return(0,n.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:c})}},78335:()=>{},96487:()=>{},97090:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var a=r(56037),o=r.n(a);let s="mongodb+srv://sevvalmertoglu131:Rvs1KjO1IbX9WVGL@cluster0.7hsg4vx.mongodb.net/dashboard?retryWrites=true&w=majority&appName=Cluster0";if(!s)throw Error("MONGODB_URI is not defined in environment variables");let n=global.mongoose??{conn:null,promise:null},u=async function(){if(n.conn)return console.log("MongoDB bağlantısı zaten mevcut"),n.conn;n.promise||(console.log("MongoDB bağlantısı başlatılıyor..."),n.promise=o().connect(s,{bufferCommands:!0,maxPoolSize:10,serverSelectionTimeoutMS:5e3,socketTimeoutMS:45e3}).then(e=>(console.log("MongoDB bağlantısı başarılı!"),e.connection)).catch(e=>{throw console.error("MongoDB bağlantı hatası:",e),e}));try{return n.conn=await n.promise,global.mongoose=n,n.conn}catch(e){throw n.promise=null,e}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[447,580],()=>r(68174));module.exports=a})();