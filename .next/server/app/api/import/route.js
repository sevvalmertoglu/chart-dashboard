(()=>{var e={};e.id=65,e.ids=[65],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44810:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});var o=t(56037),a=t.n(o);let n=new(a()).Schema({date:{type:Date,required:!0,get:e=>e.toISOString().split("T")[0]},sales_amount:{type:Number,required:!0},profit:{type:Number,required:!0},fuelType:{type:String,enum:["Diesel","Ad Blue","Super E5","Super E10"],required:!0},tankId:{type:String,required:!0},malfunctionCount:{type:Number,default:0},fill_rate:{type:Number,required:!0,min:0,max:100}},{timestamps:!0,toJSON:{getters:!0}});n.index({date:1});let s=a().models.Sale||a().model("Sale",n)},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},56037:e=>{"use strict";e.exports=require("mongoose")},61636:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>f,routeModule:()=>c,serverHooks:()=>g,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>d});var o={};t.r(o),t.d(o,{POST:()=>p});var a=t(96559),n=t(48088),s=t(37719),i=t(32190),l=t(97090),u=t(44810);async function p(e){try{await (0,l.A)();let{data:r}=await e.json();if(console.log("Alınan ham veriler:",r),!Array.isArray(r))return console.error("Ge\xe7ersiz veri formatı:",r),i.NextResponse.json({error:"Ge\xe7ersiz veri formatı"},{status:400});let t=r.filter(e=>{let r=new Date(e.date),t=parseFloat(e.sales_amount),o=parseFloat(e.profit),a=parseInt(e.malfunctionCount),n=parseFloat(e.fill_rate),s=!isNaN(r.getTime())&&!isNaN(t)&&!isNaN(o)&&!isNaN(a)&&!isNaN(n)&&n>=0&&n<=100&&["Diesel","Ad Blue","Super E5","Super E10"].includes(e.fuelType)&&e.tankId;return s||console.log("Ge\xe7ersiz satır:",e),s}).map(e=>({...e,date:new Date(e.date),sales_amount:parseFloat(e.sales_amount),profit:parseFloat(e.profit),malfunctionCount:parseInt(e.malfunctionCount),fill_rate:parseFloat(e.fill_rate)}));if(0===t.length)return i.NextResponse.json({error:"Ge\xe7erli veri bulunamadı"},{status:400});let o=await u.A.insertMany(t);return console.log("Veritabanına eklenen kayıtlar:",o),i.NextResponse.json({message:`${t.length} kayıt başarıyla i\xe7e aktarıldı`,invalidCount:r.length-t.length})}catch(e){return console.error("Import API Error:",e),i.NextResponse.json({error:"Sunucu hatası"},{status:500})}}let c=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/import/route",pathname:"/api/import",filename:"route",bundlePath:"app/api/import/route"},resolvedPagePath:"/Users/sevvalmertoglu/Desktop/chart-dashboard/app/api/import/route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:m,workUnitAsyncStorage:d,serverHooks:g}=c;function f(){return(0,s.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:d})}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},96487:()=>{},97090:(e,r,t)=>{"use strict";t.d(r,{A:()=>i});var o=t(56037),a=t.n(o);let n="mongodb+srv://sevvalmertoglu131:Rvs1KjO1IbX9WVGL@cluster0.7hsg4vx.mongodb.net/dashboard?retryWrites=true&w=majority&appName=Cluster0";if(!n)throw Error("MONGODB_URI is not defined in environment variables");let s=global.mongoose??{conn:null,promise:null},i=async function(){if(s.conn)return console.log("MongoDB bağlantısı zaten mevcut"),s.conn;s.promise||(console.log("MongoDB bağlantısı başlatılıyor..."),s.promise=a().connect(n,{bufferCommands:!0,maxPoolSize:10,serverSelectionTimeoutMS:5e3,socketTimeoutMS:45e3}).then(e=>(console.log("MongoDB bağlantısı başarılı!"),e.connection)).catch(e=>{throw console.error("MongoDB bağlantı hatası:",e),e}));try{return s.conn=await s.promise,global.mongoose=s,s.conn}catch(e){throw s.promise=null,e}}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[447,580],()=>t(61636));module.exports=o})();